(function(d) {
    var a = function(i) {
        return new a.fn.init(i)
    };
    var c = "",
        g = 0,
        f = 10000,
        e = {},
        b;
    a.fn = a.prototype = {
        init: function(n) {
            var j = this,
                i = "",
                m = "",
                l = global_sure,global_cancel;
            var k = function() {};
            if (typeof(n) == "string") {
                if ($.trim(n) != "") {
                    c = n
                } else {
                    c = i
                }
                j.title = m;
                j.obTxt = l[0];
                j.cbTxt = l[1];
                j.moreBox = false;
                j.drop = false;
                j.okFn = function() {
                    return true
                };
                j.cancelFn = function() {
                    return true
                };
                j.closeFn = function() {
                    return true
                };
                j.goTopage(j._html(""))
            } else {
                if (n) {
                    if (!j.isObject(n)) {
                        return
                    }
                    var o = $.trim(j.getHtml(n.message));
                    c = o != "" ? o: i;
                    j.title = ($.trim(n.title) != "" && n.title != undefined) ? n.title: m;
                    j.obTxt = ($.trim(n.obTxt) != "" && n.obTxt != undefined) ? n.obTxt: l[0];
                    j.cbTxt = ($.trim(n.cbTxt) != "" && n.cbTxt != undefined) ? n.cbTxt: l[1];
                    j.vBtn = ($.trim(n.vBtn) != "" && n.vBtn != undefined) ? n.vBtn: "all";
                    j.moreBox = n.moreBox != undefined ? n.moreBox: true;
                    j.drop = true;
                    j.okFn = n.okFn && j.isFunction(n.okFn) ? n.okFn: function() {
                        return true
                    };
                    j.cancelFn = n.cancelFn && j.isFunction(n.cancelFn) ? n.cancelFn: function() {
                        return true
                    };
                    j.closeFn = n.closeFn && j.isFunction(n.closeFn) ? n.closeFn: function() {
                        return true
                    };
                    j.goTopage(j._html(n.message))
                }
            }
            return j
        },
        goTopage: function(m) {
            if (g>=2) return;
            g++;
            var n = $('<div class="pop_confirm">'),
                l = "pop" + Math.random().toString().replace(/\w\./, "_").substr(0, 5),
                k = n.clone();
            n.attr("id", l);
            n.css({
                position: "absolute",
                "z-index": f * g
            });
            n.html(m);
            k.addClass("c_mask");
            if (!this.moreBox) {
                $(".pop_confirm").remove();
                g = 1
            }
            $("body").append(n);
            var i = $(".pop_confirm").length;
            if (i == 1) {
                $("body").append(k)
            }
            this.lockScreen();
            b = this.boxPosition("#" + l);
            var j = $("#" + l);
            this.moveOn(j, "r-btn");
            j.attr("r-sVal", j.width() + "|" + j.height())
        },
        getHtml: function(k) {
            var j = "",
                i;
            if (typeof(k) == "string" && $.trim(k) != "") {
                i = $(k);
                j = i.clone().html();
                e[k] = j;
                i.html("")
            }
            return j
        },
        setHtml: function(j) {
            if ($.trim(j) == "") {
                return
            }
            for (var k in e) {
                if (j == k) {
                    $(j).html(e[k])
                }
            }
        },
        _html: function(j) {
            if (typeof(j) != "string") {
                return
            }
            var i = '<table border="0" cellspacing="0" cellpadding="0" align="left" class="c_cont">';
            i += '<tr r-drag="yes"><td valign="top"><div class="c_title" ><span>' + this.title + '</span></div><a href="javascript:void(0);" class="close" title="close" r-btn="close"></a><a href="javascript:void(0);" class="open" title="open" r-btn="open"></a></td></tr>';
            i += '<tr><td  valign="top"><div class="c_default-conts" ' + ($.trim(j) != "" ? 'r-group="' + j + '"': "") + ">" + c + "</div></td></tr>";
            if (this.vBtn != "none") {
                i += '<tr r-footer><td valign="middle" class="c_btn">';
                if (this.vBtn == "ok") {
                    i += '<a tabindex="6" class="btn btn-primary" href="javascript:void(0)"  r-btn="ok"><span>' + this.obTxt + "</span></a>"
                } else {
                    if (this.vBtn == "no") {
                        i += '<a tabindex="6" class="btn btn-default" href="javascript:void(0)"  r-btn="cancel"><span>' + this.cbTxt + "</span></a>"
                    } else {
                        i += '<a tabindex="6" class="btn btn-default" href="javascript:void(0)" r-btn="cancel"><span>' + this.cbTxt + '</span></a><a tabindex="6" class="btn btn-primary c_ml15" href="javascript:void(0)" r-btn="ok"><span>' + this.obTxt + "</span></a>"
                    }
                }
                i += "</td></tr>"
            }
            i += "</table>";
            return i
        },
        moveOn: function(j, k) {
            var i = this;
            j.on("click", "[" + k + "]",
                function() {
                    var m = $(this),
                        n = m.attr(k);
                    var q = m.closest(".pop_confirm"),
                        l = q.find("[r-group]").attr("r-group");
                    switch (n) {
                        case "ok":
                            var p = i.okFn();
                            if (p) {
                                if (l) {
                                    i.setHtml(l)
                                }
                                q.remove();
                                g--;
                                i.lockScreen()
                            }
                            break;
                        case "cancel":
                            var t = i.cancelFn();
                            if (t) {
                                if (l) {
                                    i.setHtml(l)
                                }
                                q.remove();
                                g--;
                                i.lockScreen()
                            }
                            break;
                        case "close":
                            var s = i.closeFn();
                            if (s) {
                                if (l) {
                                    i.setHtml(l)
                                }
                                q.remove();
                                g--;
                                i.lockScreen()
                            }
                            break;
                        case "open":
                            var r = j.attr("r-state");
                            if (r == "yes") {
                                var o = j.attr("r-sVal").split("|");
                                i.zoomWindow(j, {
                                    w: o[0],
                                    h: o[1]
                                });
                                j.attr("r-state", "no")
                            } else {
                                i.zoomWindow(j);
                                j.attr("r-state", "yes")
                            }
                            break;
                        case "lock":
                            a.blank("c_cont", 3);
                            break
                    }
                    if (g == 0) {
                        $(".c_mask").remove()
                    }
                })
        },
        lockScreen: function() {
            var j = $("<p>");
            j.css({
                position: "absolute",
                top: "0px",
                left: "0px",
                "z-index": (f * g) + 1
            });
            j.attr("r-btn", "lock");
            j.addClass("lock");
            var i = $("[r-group]");
            i.each(function(m) {
                var n = $(this),
                    l = n.find(".lock");
                if (m != (g - 1)) {
                    if (l.length == 0) {
                        var k = n.closest(".c_cont");
                        j.css({
                            width: k.width(),
                            height: k.height()
                        });
                        n.append(j)
                    }
                } else {
                    l.remove()
                }
            })
        },
        boxPosition: function(k) {
            if (typeof(k) != "string") {
                return
            }
            var j = this;
            var i = {
                init: function(n) {
                    var m = $(n);
                    w = m.width(),
                        h = m.height();
                    var l = this.center(w, h);
                    m.css({
                        top: l.top,
                        left: l.left
                    });
                    this.drag(j.drop, n);
                    return this
                },
                center: function(l, n) {
                    var q = $(window),
                        m = q.width(),
                        p = q.height();
                    var o = q.scrollTop(),
                        r = q.scrollLeft();
                    return {
                        top: (p - n) / 2 + o,
                        left: (m - l) / 2 + r
                    }
                },
                move: function(o, p, r, l, m, n) {
                    var q = {};
                    o.bind("mousemove",
                        function(A) {
                            var z = $(this);
                            q.x = A.clientX;
                            q.y = A.clientY;
                            var C = z.scrollLeft(),
                                B = z.scrollTop();
                            var x = r + (q.y - m),
                                v = l + (q.x - n);
                            var y = p.width(),
                                t = p.height();
                            var u = z.width(),
                                s = z.height();
                            if (v <= 0) {
                                v = 0
                            } else {
                                if ((v + y) >= u) {
                                    v = u - y
                                }
                            }
                            if (x <= 0) {
                                x = 0
                            } else {
                                if ((x + t) >= s) {
                                    x = s - t
                                }
                            }
                            p.css({
                                top: x + "px",
                                left: v + "px"
                            });
                            j.stopDefault(A)
                        })
                },
                drag: function(n, l, r) {
                    if (!j.isBoolean(n)) {
                        return
                    } else {
                        if (!n) {
                            return
                        }
                    }
                    var p = this,
                        q = r || $(document);
                    var s = j.isObject(q) ? q: $(q);
                    var o = $(l),
                        m = o.find("[r-drag]");
                    var t = ["mousedown", "mouseup"];
                    m.bind(t[0],
                        function(A) {
                            m.css("cursor", "move");
                            var z = o.offset().top,
                                v = o.offset().left,
                                u = A.clientX,
                                B = A.clientY;
                            p.move(s, o, z, v, B, u);
                            j.stopDefault(A)
                        });
                    s.bind(t[1],
                        function() {
                            m.css("cursor", "");
                            s.unbind("mousemove")
                        })
                }
            };
            return i.init(k)
        },
        zoomWindow: function(j, n) {
            var o = $(j),
                t = o.find(".c_default-conts");
            var s = 0,
                p = 0,
                l = 8,
                k = 30,
                m = o.find("[r-footer]").height();
            if (n) {
                s = n.w - l;
                p = n.h - (k + l + m);
                var i = b.center(n.w, n.h);
                o.css({
                    top: i.top,
                    left: i.left
                })
            } else {
                var q = $(window),
                    r = q.scrollTop();
                o.css({
                    top: r + "px",
                    left: "0px"
                });
                s = q.width() - l;
                p = q.height() - (k + l + m)
            }
            t.css({
                width: s + "px",
                height: p + "px"
            });
            t.children().css({
                width: "100%",
                height: "100%"
            })
        },
        error: function(j, i) {},
        stopDefault: function(i) {
            if (i && i.preventDefault) {
                i.preventDefault()
            } else {
                window.event.returnValue = false
            }
            return false
        },
        isBoolean: function(i) {
            return Object.prototype.toString.call(i) === "[object Boolean]"
        },
        isFunction: function(i) {
            return Object.prototype.toString.call(i) === "[object Function]"
        },
        isObject: function(i) {
            return Object.prototype.toString.call(i) === "[object Object]"
        }
    };
    a.normal = function(k, j) {
        var i = $("." + k).last();
        i.css("border-color", "");
        if (j < 0) {
            return
        }
        j = j - 1;
        setTimeout("confirmBox.blank('" + k + "'," + j + ")", 60)
    };
    a.blank = function(k, j) {
        var i = $("." + k).last();

            i.css("border-color", "#ffffcc")

        j = j - 1;
        setTimeout("confirmBox.normal('" + k + "'," + j + ")", 120)
    };
    a.fn.init.prototype = a.fn;
    d.confirmBox = a
})(window, undefined);